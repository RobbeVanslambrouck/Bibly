import{v as A,w as Y,x as te,y as k,z as le,A as D,B as ne,C as re,D as M,E as j,F as q,n as H,q as S,a as C,t as F,c as O,k as se,G as ie,d as w,f as G,b as L,o as oe,s as E,m as ue,i as P,h as ce,H as V}from"../chunks/disclose-version.CTnrH94W.js";import{l as B,r as I,m as fe,E as J,o as _e,q as ve,v as T,w as de,x as Q,y as K,z as W,A as he,B as be,C as pe,k as U,d as Z,b as $,p as ee,s as ae,h as me,D as ge,F as ye,G as xe}from"../chunks/runtime.CvKES5CI.js";import{l as N,e as Ee}from"../chunks/stores.CTPIIeXP.js";function ke(){}function Ce(e,n,l,r,s,c,h){const m=(l&T)!==0,t=ve(l,e);let _=null;te(e,m);let b,y=null,a=null,v=!1;t.r=i=>{const o=_,f=o.s;f.add(i),i.f(()=>{f.delete(i),f.size===0&&o.e!==null&&(o.d!==null&&(A(o.d),o.d=null),B(o.e),o.e=null)})};const u=()=>{const i={d:null,e:null,s:new Set,p:_},o=I(()=>{const f=t.d;f!==null&&(A(f),t.d=null);let g=t.a;(t.f&T)!==0&&(k===null?(g=le(),t.a.appendChild(g)):g=g.firstChild),c(g),i.d=t.d,t.d=null},t,!0);i.e=o,_=i},d=i=>{const o=i.f,f=(o&T)!==0,g=i.a;h(b,i,g,f,s,o,!0,y)},p=I(()=>{var f,g;const i=n();b=fe(i)?i:i==null?[]:Array.from(i),r!==null?y=b.map(r):l&J||b.map(ke);const o=b.length;if(k!==null){const x=((g=(f=k)==null?void 0:f[0])==null?void 0:g.data)==="ssr:each_else";x&&o||!x&&!o?(A(k),D(null),v=!0):x&&k.shift()}if(c!==null){if(o===0){if(t.v.length!==0||a===null){d(t),u();return}}else if(t.v.length===0&&_!==null){const x=_,z=x.s;z.size===0?x.d!==null&&(A(x.d),x.d=null):Y(z,"out")}}a!==null&&de(a)},t,!1);a=I(d,t,!0),v&&D([]),_e(p,()=>{const i=t.f,o=t.a,f=(i&T)!==0;let g=_;for(;g!==null;){const x=g.d;x!==null&&A(x);const z=g.e;z!==null&&B(z),g=g.p}h([],t,o,f,s,i,!1,y),B(a)}),t.e=p}function Ae(e,n,l,r,s){Ce(e,n,l,null,r,s,ze)}function ze(e,n,l,r,s,c,h){var m=n.v,t=n.s,_=m.length,b=e.length,y=Math.max(_,b),a=0,v,u;if(t.length!==0&&Te(t),b===0)for(v=[],r&&_!==0&&ne(l);a<y;)u=m[a++],R(u,t,h,r);else{var d,p=k!==null;if(v=Array(b),p){for(var i=k,o=i[0];a<y;a++){var f=re(o);if(D(f),!f)break;d=e[a],u=X(d,null,a,s,c),v[a]=u,o=f.at(-1).nextSibling.nextSibling}Ie(i,o)}for(;a<y;a++)a>=_?(d=e[a],u=X(d,null,a,s,c),v[a]=u,we(u,l,r,null)):a>=b?(u=m[a],R(u,t,h)):(d=e[a],u=m[a],v[a]=u,Be(u,d,a,c));p&&k===null&&D([])}n.v=v}function Ie(e,n){if(n!==null){var l=e.indexOf(n);l!==-1&&e.length>l+1&&A(e.slice(l))}}function we(e,n,l,r){var s=e.d;return r===null?l?M(s,n,null):M(s,n.parentNode,n):M(s,null,r)}function Te(e){var n=e.length;if(n>0){for(var l=0,r,s;l<n;l++)r=e[l],s=r.r,s!==null&&(r.r=null,R(r,null,!1));e.length=0}}function Be(e,n,l,r){const s=e.v;r&Q&&K(s,n);const c=e.s,h=(r&W)!==0,m=e.a;c!==null&&r&J&&m!==null&&m(e,c),h?K(e.i,l):e.i=l}function R(e,n,l,r=!1){const s=e.s;if(l&&s!==null){for(let h of s)h.r==="key"&&s.delete(h);if(s.size===0)e.s=null;else{Y(s,"out"),n!==null&&n.push(e);return}}const c=e.d;!r&&c!==null&&A(c),B(e.e)}function X(e,n,l,r,s){const h=(s&Q)===0?e:s&be?U(e):pe(e),m=s&W?U(l):l,t=he(h,m,n),_=I(b=>{r(null,b.v,b.i)},t,!0);return t.e=_,t}let De=!1;const Fe=Object.freeze(Object.defineProperty({__proto__:null,ssr:De},Symbol.toStringTag,{value:"Module"}));var He=w("<p> </p> - <p> </p>",!0),Se=w('<img class="svelte-zubad5">'),Me=w('<a class="svelte-zubad5"><!></a>');function Oe(e,n){Z(n,!0);const l={};$(l);const r=()=>ae(N,"$library",l);let s=r()[n.libIndex];var c=S(e,!0,Me),h=C(c);j(c,"href",()=>`./reader/${n.libIndex}`),q(h,()=>r()[n.libIndex].loaded.metadata,null,(m,t)=>{var _=G(m),b=L(_);q(b,()=>s.coverUrl(),y=>{var a=oe(y,!0,He),v=L(a),u=C(v),d=E(E(v,!0)),p=C(d);I(()=>{F(u,t.title),F(p,t.creator)}),O(y,a)},(y,a)=>{var v=G(y),u=L(v);se(u,()=>a,d=>{var p=S(d,!0,Se);ie(p,"src",a),j(p,"alt",()=>`${t.title} cover`),H(d,p)},null),O(y,v)},null),O(m,_)},null),H(e,c),ee()}var Le=w("<li><!></li>"),Ne=w('<main class="svelte-17e62un"><h1>Bibly</h1> <section><h2> </h2> <ul id="books" class="svelte-17e62un"><!> <div class="book svelte-17e62un" id="drop_zone"><p>Drag one or more epub files to this <i>drop zone</i>.</p></div></ul></section></main>');function Ge(e,n){Z(n,!0);const l={};$(l);const r=()=>ae(N,"$library",l);let s=ye(()=>r().length);async function c(u){if(!u.dataTransfer)return;let d=u.dataTransfer.files;for(let p=0;p<d.length;p++){const i=d[p];if(i.type!=="application/epub+zip")continue;let o=await i.arrayBuffer(),f=Ee(o);xe(N,[...r(),f])}}var h=S(e,!0,Ne),m=C(h),t=E(E(m,!0)),_=C(t),b=C(_),y=E(E(_,!0)),a=C(y),v=E(E(a,!0));ue(b,()=>`library (${ce(me(s))})`),Ae(a,r,65,(u,d,p)=>{var i=S(u,!0,Le),o=C(i);Oe(o,{libIndex:ge(p)}),H(u,i)},null),P("drop",v,V(c),!1),P("dragover",v,V(()=>{}),!1),H(e,h),ee()}export{Ge as component,Fe as universal};
